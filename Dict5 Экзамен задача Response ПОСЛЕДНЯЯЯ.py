import datetime as dt
import requests

DATABASE = {
    '–°–µ—Ä–≥–µ–π': '–û–º—Å–∫',
    '–°–æ–Ω—è': '–ú–æ—Å–∫–≤–∞',
    '–ê–ª–µ–∫—Å–µ–π': '–ö–∞–ª–∏–Ω–∏–Ω–≥—Ä–∞–¥',
    '–ú–∏—à–∞': '–ú–æ—Å–∫–≤–∞',
    '–î–∏–º–∞': '–ß–µ–ª—è–±–∏–Ω—Å–∫',
    '–ê–ª–∏–Ω–∞': '–ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫',
    '–ï–≥–æ—Ä': '–ü–µ—Ä–º—å',
    '–ö–æ–ª—è': '–ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫',
    '–ê—Ä—Ç—ë–º': '–í–ª–∞–¥–∏–≤–æ—Å—Ç–æ–∫',
    '–ü–µ—Ç—è': '–ú–∏—Ö–∞–π–ª–æ–≤–∫–∞'
}

UTC_OFFSET = {
    '–ú–æ—Å–∫–≤–∞': 3,
    '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥': 3,
    '–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫': 7,
    '–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥': 5,
    '–ù–∏–∂–Ω–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥': 3,
    '–ö–∞–∑–∞–Ω—å': 3,
    '–ß–µ–ª—è–±–∏–Ω—Å–∫': 5,
    '–û–º—Å–∫': 6,
    '–°–∞–º–∞—Ä–∞': 4,
    '–†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É': 3,
    '–£—Ñ–∞': 5,
    '–ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫': 7,
    '–í–æ—Ä–æ–Ω–µ–∂': 3,
    '–ü–µ—Ä–º—å': 5,
    '–í–æ–ª–≥–æ–≥—Ä–∞–¥': 3,
    '–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä': 3,
    '–ö–∞–ª–∏–Ω–∏–Ω–≥—Ä–∞–¥': 2,
    '–í–ª–∞–¥–∏–≤–æ—Å—Ç–æ–∫': 10
}


def format_count_friends(count_friends):
    if count_friends == 1:
        return '1 –¥—Ä—É–≥'
    elif 2 <= count_friends <= 4:
        return f'{count_friends} –¥—Ä—É–≥–∞'
    else:
        return f'{count_friends} –¥—Ä—É–∑–µ–π'


def what_time(city):
    offset = UTC_OFFSET[city]
    city_time = dt.datetime.utcnow() + dt.timedelta(hours=offset)
    f_time = city_time.strftime("%H:%M")
    return f_time


def what_weather(city):
    url = f'http://wttr.in/{city}'
    weather_parameters = {
        'format': 2,
        'M': ''
    }
    try:
        response = requests.get(url, params=weather_parameters)
    except requests.ConnectionError:
        return '<—Å–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞>'
    if response.status_code == 200:
        return response.text
    else:
        return '<–æ—à–∏–±–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –ø–æ–≥–æ–¥—ã>'


def process_anfisa(query):
    if query == '—Å–∫–æ–ª—å–∫–æ —É –º–µ–Ω—è –¥—Ä—É–∑–µ–π?':
        count = len(DATABASE)
        return f'–£ —Ç–µ–±—è {format_count_friends(count)}.'
    elif query == '–∫—Ç–æ –≤—Å–µ –º–æ–∏ –¥—Ä—É–∑—å—è?':
        friends_string = ', '.join(DATABASE)
        return f'–¢–≤–æ–∏ –¥—Ä—É–∑—å—è: {friends_string}'
    elif query == '–≥–¥–µ –≤—Å–µ –º–æ–∏ –¥—Ä—É–∑—å—è?':
        unique_cities = set(DATABASE.values())
        cities_string = ', '.join(unique_cities)
        return f'–¢–≤–æ–∏ –¥—Ä—É–∑—å—è –≤ –≥–æ—Ä–æ–¥–∞—Ö: {cities_string}'
    else:
        return '<–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∑–∞–ø—Ä–æ—Å>'


def process_friend(name, query):
    if name in DATABASE:
        city = DATABASE[name]
        if query == '—Ç—ã –≥–¥–µ?':
            return f'{name} –≤ –≥–æ—Ä–æ–¥–µ {city}'
        elif query == '–∫–æ—Ç–æ—Ä—ã–π —á–∞—Å?':
            if city not in UTC_OFFSET:
                return f'<–Ω–µ –º–æ–≥—É –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤—Ä–µ–º—è –≤ –≥–æ—Ä–æ–¥–µ {city}>'
            time = what_time(city)
            return f'–¢–∞–º —Å–µ–π—á–∞—Å {time}'
        elif query == '–∫–∞–∫ –ø–æ–≥–æ–¥–∞?':
            return f'{what_weather(city)}'
        else:
            return '<–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∑–∞–ø—Ä–æ—Å>'
    else:
        return f'–£ —Ç–µ–±—è –Ω–µ—Ç –¥—Ä—É–≥–∞ –ø–æ –∏–º–µ–Ω–∏ {name}'


def process_query(query):
    elements = query.split(', ')
    if elements[0] == '–ê–Ω—Ñ–∏—Å–∞':
        return process_anfisa(elements[1])
    else:
        return process_friend(elements[0], elements[1])


def runner():
    queries = [
        '–ê–Ω—Ñ–∏—Å–∞, —Å–∫–æ–ª—å–∫–æ —É –º–µ–Ω—è –¥—Ä—É–∑–µ–π?',
        '–ê–Ω—Ñ–∏—Å–∞, –∫—Ç–æ –≤—Å–µ –º–æ–∏ –¥—Ä—É–∑—å—è?',
        '–ê–Ω—Ñ–∏—Å–∞, –≥–¥–µ –≤—Å–µ –º–æ–∏ –¥—Ä—É–∑—å—è?',
        '–ê–Ω—Ñ–∏—Å–∞, –∫—Ç–æ –≤–∏–Ω–æ–≤–∞—Ç?',
        '–ö–æ–ª—è, —Ç—ã –≥–¥–µ?',
        '–°–æ–Ω—è, —á—Ç–æ –¥–µ–ª–∞—Ç—å?',
        '–ê–Ω—Ç–æ–Ω, —Ç—ã –≥–¥–µ?',
        '–ê–ª–µ–∫—Å–µ–π, –∫–æ—Ç–æ—Ä—ã–π —á–∞—Å?',
        '–ê—Ä—Ç—ë–º, –∫–æ—Ç–æ—Ä—ã–π —á–∞—Å?',
        '–ê–Ω—Ç–æ–Ω, –∫–æ—Ç–æ—Ä—ã–π —á–∞—Å?',
        '–ü–µ—Ç—è, –∫–æ—Ç–æ—Ä—ã–π —á–∞—Å?',
        '–ö–æ–ª—è, –∫–∞–∫ –ø–æ–≥–æ–¥–∞?',
        '–°–æ–Ω—è, –∫–∞–∫ –ø–æ–≥–æ–¥–∞?',
        '–ê–Ω—Ç–æ–Ω, –∫–∞–∫ –ø–æ–≥–æ–¥–∞?'
    ]
    for query in queries:
        print(query, '-', process_query(query))

runner()
##–ê–Ω—Ñ–∏—Å–∞, —Å–∫–æ–ª—å–∫–æ —É –º–µ–Ω—è –¥—Ä—É–∑–µ–π? - –£ —Ç–µ–±—è 10 –¥—Ä—É–∑–µ–π.
##–ê–Ω—Ñ–∏—Å–∞, –∫—Ç–æ –≤—Å–µ –º–æ–∏ –¥—Ä—É–∑—å—è? - –¢–≤–æ–∏ –¥—Ä—É–∑—å—è: –°–µ—Ä–≥–µ–π, –°–æ–Ω—è, –ê–ª–µ–∫—Å–µ–π, –ú–∏—à–∞, –î–∏–º–∞, –ê–ª–∏–Ω–∞, –ï–≥–æ—Ä, –ö–æ–ª—è, –ê—Ä—Ç—ë–º, –ü–µ—Ç—è
##–ê–Ω—Ñ–∏—Å–∞, –≥–¥–µ –≤—Å–µ –º–æ–∏ –¥—Ä—É–∑—å—è? - –¢–≤–æ–∏ –¥—Ä—É–∑—å—è –≤ –≥–æ—Ä–æ–¥–∞—Ö: –ú–æ—Å–∫–≤–∞, –ö–∞–ª–∏–Ω–∏–Ω–≥—Ä–∞–¥, –û–º—Å–∫, –ß–µ–ª—è–±–∏–Ω—Å–∫, –ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫, –ü–µ—Ä–º—å, –ú–∏—Ö–∞–π–ª–æ–≤–∫–∞, –í–ª–∞–¥–∏–≤–æ—Å—Ç–æ–∫
##–ê–Ω—Ñ–∏—Å–∞, –∫—Ç–æ –≤–∏–Ω–æ–≤–∞—Ç? - <–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∑–∞–ø—Ä–æ—Å>
##–ö–æ–ª—è, —Ç—ã –≥–¥–µ? - –ö–æ–ª—è –≤ –≥–æ—Ä–æ–¥–µ –ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫
##–°–æ–Ω—è, —á—Ç–æ –¥–µ–ª–∞—Ç—å? - <–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∑–∞–ø—Ä–æ—Å>
##–ê–Ω—Ç–æ–Ω, —Ç—ã –≥–¥–µ? - –£ —Ç–µ–±—è –Ω–µ—Ç –¥—Ä—É–≥–∞ –ø–æ –∏–º–µ–Ω–∏ –ê–Ω—Ç–æ–Ω
##–ê–ª–µ–∫—Å–µ–π, –∫–æ—Ç–æ—Ä—ã–π —á–∞—Å? - –¢–∞–º —Å–µ–π—á–∞—Å 07:59
##–ê—Ä—Ç—ë–º, –∫–æ—Ç–æ—Ä—ã–π —á–∞—Å? - –¢–∞–º —Å–µ–π—á–∞—Å 15:59
##–ê–Ω—Ç–æ–Ω, –∫–æ—Ç–æ—Ä—ã–π —á–∞—Å? - –£ —Ç–µ–±—è –Ω–µ—Ç –¥—Ä—É–≥–∞ –ø–æ –∏–º–µ–Ω–∏ –ê–Ω—Ç–æ–Ω
##–ü–µ—Ç—è, –∫–æ—Ç–æ—Ä—ã–π —á–∞—Å? - <–Ω–µ –º–æ–≥—É –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤—Ä–µ–º—è –≤ –≥–æ—Ä–æ–¥–µ –ú–∏—Ö–∞–π–ª–æ–≤–∫–∞>
##–ö–æ–ª—è, –∫–∞–∫ –ø–æ–≥–æ–¥–∞? - üå®  üå°Ô∏è-7¬∞C üå¨Ô∏è‚Üí6.1m/s
##
##–°–æ–Ω—è, –∫–∞–∫ –ø–æ–≥–æ–¥–∞? - ‚ùÑÔ∏è   üå°Ô∏è-4¬∞C üå¨Ô∏è‚Üê5.3m/s
##
##–ê–Ω—Ç–æ–Ω, –∫–∞–∫ –ø–æ–≥–æ–¥–∞? - –£ —Ç–µ–±—è –Ω–µ—Ç –¥—Ä—É–≥–∞ –ø–æ –∏–º–µ–Ω–∏ –ê–Ω—Ç–æ–Ω

